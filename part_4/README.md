交易
-----
每一笔比特币交易都会创造输出，输出都会被区块链记录下来。给某个人发送比特币，实际上意味着创造新的 UTXO 并注册到那个人的地址，可以为他所用。


### 输入
一个输入引用（花费）之前交易的一个输出（即余额），coinbase 交易除外。

##### 输入包含部分
1. Txid 存储的是之前交易的 ID，
2. Vout 存储的是该输出在那笔交易中所有输出的索引（因为一笔交易可能有多个输出，需要有信息指明是具体的哪一个）
3. ScriptSig 是一个脚本，提供了可解锁输出结构里面 ScriptPubKey 字段的数据
   1. 如果 ScriptSig 提供的数据是正确的，那么输出就会被解锁，然后被解锁的值就可以被用于产生新的输出；
   2. 如果数据不正确，输出就无法被引用在输入中，或者说，无法使用这个输出。这种机制，保证了用户无法花费属于其他人的币。

### 输出 -- 余额
###### 输出包含两部分
1. 一定量的比特币(Value)
2. 一个锁定脚本(ScriptPubKey)，要花这笔钱，必须要解锁该脚本。

###### 理解输出
1. 输出里面存储了“币”（注意，也就是Value 字段）。而这里的存储，指的是用一个数学难题对输出进行锁定，这个难题被存储在 ScriptPubKey（这里先使用一个任意的字符串 -- 用户定义的钱包地址） 里面。在内部，比特币使用了一个叫做 Script 的脚本语言，用它来定义锁定和解锁输出的逻辑。
2. 输出是不可分割使用的，必须一次性用完。当一个新的交易中引用了某个输出，那么这个输出必须被全部花费。如果它的值比需要的值大，那么就会产生一个找零，找零会返还给发送方。


### 概念理解
1. 比特币的每个区块中，存放的都是一笔笔的交易信息。
2. 比特币的交易中不是通过账户的增减来实现的，而是一笔笔关联的输入/输出交易事务。
3. 每一笔的交易都要花费“输入”，然后产生“输出”，这个产生的“输出”就是所谓的“未花费过的交易输出”，也就是UTXO。每一笔交易事务都有一个唯一的编号，称为交易事务ID，这是通过哈希算法计算而来的，当需要引用某一笔交易事务中的“输出”时，主要提供交易事务ID和所处“输出”列表中的序号就可以了。
3. 由于没有账户的概念，因此当“输入”部分的金额大于所需的“输出”时，必须给自己找零，这个找零也是作为交易的一部分包含在“输出”中。


### coinbase 交易
###### 产生coinbase的两种情况
1. 在区块链的最初，也就是第一个块，叫做创世块。正是这个创世块，产生了区块链最开始的输出。对于创世块，不需要引用之前的交易输出。因为在创世块之前根本不存在交易，也就没有不存在交易输出。
2. 当矿工挖出一个新的块时，它会向新的块中添加一个 coinbase 交易。coinbase 交易是一种特殊的交易，它不需要引用之前一笔交易的输出。它“凭空”产生了币（也就是产生了新币），这是矿工获得挖出新块的奖励，也可以理解为“发行新币”。

###### 特点
1. coinbase 交易 与常规交易不同，不消耗UTXO
2. coinbase 交易又被称作创币交易（挖矿奖励）。创币交易有一个输出，支付到这个矿工的比特币地址。


### 交易哈希
通过把一个块中所有交易转为hash ,可以达到通过仅仅一个哈希，就可以识别一个块里面的所有交易的目的。
> 比特币使用了一个更加复杂的技术：它将一个块里面包含的所有交易表示为一个  Merkle tree ，然后在工作量证明系统中使用树的根哈希（root hash）。这个方法能够让我们快速检索一个块里面是否包含了某笔交易，即只需 root hash 而无需下载所有交易即可完成判断。


### UTXO -- 未花费交易输出
未花费（unspent） 指的是这个输出还没有被包含在任何交易的输入中，或者说没有被任何输入引用.

##### UTXO 归属问题 -- 加密和解密
在比特币中，是使用输入脚本和输出脚本程序实现的，有时候也称为“锁定脚本”和“解锁脚本”。
简单地说，就是通过“锁定脚本“，，利用私钥签名解锁自己的某一条UTXO（也就是之前的“输出”），然后使用对方的公钥锁定新的“输出”，成功后，这笔新的“输出”就成为了对方的UTXO。同样，对方也可以使用“锁定脚本”和“解锁脚本”来实现转账。